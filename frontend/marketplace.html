<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Windi | Marketplace</title>
  <link rel="manifest" href="/manifest.json" />
    <link rel="icon" href="/favicon.ico" sizes="any" />

  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32.png" />

  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png" />

  <link rel="apple-touch-icon" href="/icons/icon-192.png" />

<link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="mp-shell">
    <header class="app-topbar">
      <div class="app-topbar-inner">
        <div class="app-title">
          <div class="app-brand-badge" aria-hidden="true">W</div>
          <h1>Marketplace</h1>
        </div>
        <div class="app-actions">
          <span id="authInfo" class="pill">Cargando sesion...</span>
          <a class="icon-btn" href="/me/orders" aria-label="Mis pedidos">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M8 6h13M8 12h13M8 18h13"/><path d="M3 6h.01M3 12h.01M3 18h.01"/>
            </svg>
          </a>
          <a class="icon-btn" href="/mi-cuenta" aria-label="Mi cuenta">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
            </svg>
          </a>
          <button id="logoutBtn" class="icon-btn" type="button" aria-label="Salir">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><path d="M16 17l5-5-5-5"/><path d="M21 12H9"/>
            </svg>
          </button>
        </div>
      </div>
    </header>

    <div class="mp-search-sticky">
      <div class="searchbar">
        <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/>
        </svg>
        <input id="merchantSearch" class="mp-search" placeholder="Buscar comercios o productos" />
      </div>
      <div id="chipFilters" class="mp-chips">
        <button class="mp-chip active" data-filter="all">Todos</button>
        <button class="mp-chip" data-filter="promo">Promos</button>
        <button class="mp-chip" data-filter="popular">Mas vendidos</button>
      </div>
      <div id="dynamicCategoryChips" class="mp-chips"></div>
    </div>

    <main id="marketplaceHome" class="mp-view active">
      <section class="mp-section-head">
        <h1>Comercios locales</h1>
        <p>Pedidos rapidos con seguimiento en tiempo real.</p>
      </section>
      <section id="merchantList" class="mp-merchant-list"></section>
      <div class="mp-load-wrap">
        <button id="loadMoreMerchantsBtn" class="secondary">Ver mas comercios</button>
      </div>
    </main>

    <main id="merchantDetailView" class="mp-view">
      <button id="backToMarketplaceBtn" class="mp-back-btn">Volver a comercios</button>
      <section id="merchantHero" class="mp-merchant-hero"></section>
      <div class="mp-merchant-meta">
        <h2 id="merchantNameTitle"></h2>
        <p id="merchantMetaSubtitle"></p>
        <button id="shareMerchantBtn" class="mp-link-btn">Compartir</button>
      </div>
      <div id="productCategoryTabs" class="mp-tabs"></div>
      <section id="productList" class="mp-product-list"></section>
    </main>

    <div id="status" class="footer"></div>

    <div id="singleMerchantModal" class="mp-modal hidden" role="dialog" aria-modal="true">
      <div class="mp-modal-card">
        <h3>Carrito de un solo comercio</h3>
        <p>Ya tenes productos de otro comercio. Para seguir, debes vaciar el carrito actual.</p>
        <div class="mp-modal-actions">
          <button id="cancelMerchantSwitchBtn" class="secondary">Cancelar</button>
          <button id="confirmMerchantSwitchBtn">Vaciar y cambiar</button>
        </div>
      </div>
    </div>

    <a id="floatingCartBar" class="mp-cart-float hidden" href="/cart">
      <div>
        <strong id="floatingCartCount">0 productos</strong>
        <div id="floatingCartMerchant" class="muted">Carrito Windi</div>
      </div>
      <div id="floatingCartTotal">Ver carrito</div>
    </a>
  </div>

  <nav class="app-bottom-nav" aria-label="Navegacion principal">
    <div class="nav-inner">
      <a class="app-tab active" href="/marketplace" aria-label="Inicio">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><path d="M9 22V12h6v10"/>
        </svg>
        <span>Inicio</span>
      </a>
      <a class="app-tab" href="/marketplace" id="tabSearch" aria-label="Buscar">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/>
        </svg>
        <span>Buscar</span>
      </a>
      <a class="app-tab" href="/me/orders" aria-label="Pedidos">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M8 6h13M8 12h13M8 18h13"/><path d="M3 6h.01M3 12h.01M3 18h.01"/>
        </svg>
        <span>Pedidos</span>
      </a>
      <a class="app-tab" href="/mi-cuenta" aria-label="Cuenta">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
        </svg>
        <span>Cuenta</span>
      </a>
    </div>
  </nav>

  <script src="/js/sw-register.js"></script>
  <script type="module" src="/js/marketplace.js"></script>
  <script>
    const tab = document.getElementById('tabSearch');
    const input = document.getElementById('merchantSearch');
    if (tab && input) {
      tab.addEventListener('click', (e) => {
        e.preventDefault();
        input.focus();
        input.scrollIntoView({ block: 'center', behavior: 'smooth' });
      });
    }
  </script>
</body>
</html>
